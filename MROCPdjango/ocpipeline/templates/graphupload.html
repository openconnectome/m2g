{% extends "base.html" %}

  {% block title %}
    Compute Invariants | MROCP
  {% endblock title %}

  {% block medheading %}
    Please upload the graph(s) on which invariants will be computed
  {% endblock medheading %}

  {% block content %}
    {# <b>Uploading the largest connected components(LCC) file for big fiber streamline graphs is required for resonable processing time.</b> #}

     <div id=graphspecs>
      <h2>Two Specifications for acceptable graphs</h2>
      <ul>
        <li>A <a href="http://www.mathworks.com/help/matlab/ref/struct.html" target="blank"> MATLAB struct </a> with a <FONT COLOR='#2373ff'>single</FONT> data element
        that is of type <a href="http://docs.scipy.org/doc/scipy/reference/generated/scipy.sparse.csc_matrix.html#scipy.sparse.csc_matrix" target="blank">
        numpy CSC (Compressed Sparse Column) matrix</a>. <br/>
        <li>
          Any <FONT COLOR='#2373ff'>2 Dimensional</FONT> square MATLAB matrix.
        </li>
        It should be loadable from the python shell via the following call: <a href="http://docs.scipy.org/doc/scipy/reference/generated/scipy.io.loadmat.html" target="blank">scipy.io.loadmat</a>(filename)[<FONT COLOR='#2373ff'>'your_data_element_name'</FONT>] only.<br/>
        Such a matrix can be created by creating an MATLAB matrix and using the <a href="http://www.mathworks.com/help/matlab/ref/save.html" target="blank">save</a> function or via Python's
            <a href="http://docs.scipy.org/doc/scipy/reference/generated/scipy.io.savemat.html" target="blank">scipy.io.savemat </a> function.
        </li>
    </div>

    <h3 id="mult_lcc"> Graph(s) <FONT COLOR='#2373ff'>with precomputed </FONT>largest connected component</h3>
    <p> You must use a single<strong> zipfile <i> (.zip) </i> containing ALL</strong> data in a single directory even for multiple graphs. <br/>
    Note the following <b>file naming convention</b> for graphs - where the <strong>base file name must be the same</strong>:
    <ul>
      <li>The <strong>base file name </strong> here is <strong>graph1</strong></li>
      <li>Graph file name: graph1.mat, graph1_fiber.mat, graph1_smgr.mat, graph1_bggr.mat are all acceptable file names.</li>
      <li>LCC file name: <b>graph1_concomp<FONT COLOR='#ff0000'>.npy</FONT> is the only acceptable LCC file name given the base file name graph1</b>
      The connnected component file must be a &lt1 x #vertices&gt sparse matrix of type '&lttype 'numpy.int64'&gt' <a href="http://docs.scipy.org/doc/numpy/reference/generated/numpy.array.html" target="blank"> Numpy array</a>.
      </li>

    </ul>

    <div id='single'>
      <h3> Single graph <FONT COLOR='#2373ff'>without precomputed </FONT>largest connected component</h3>
        <p>
          There are NO file naming restrictions. As long as your graph meets one of the above <a href=#graphspecs>specifications</a> you may compute invariants on any MATLAB (.mat) graph of your choosing. <br/>
          Simply upload your file below, fill the <a href="#id_loadForm">form</a> below and you're on your way! Click <a href=#mult_lcc>here</a> for graphs with a largest connected component (LCC). <br/>
        </p>
    </div>

    <h3 id=mult> Multiple graphs <FONT COLOR='#2373ff'>without precomputed </FONT>largest connected component</h3>
    <p>
      There are NO file naming restrictions. To compute invariants for multiple graphs, with one click &#8212, upload a zipfile <i> (.zip) </i> with all the graphs in a <b>single</b> folder, fill the <a href="#id_loadForm">form</a> below and submit.
    </p>

    <!--
    You may adapt the file names of you data sets by appending these suffixes using
    <a href="https://github.com/openconnectome/MR-connectome/blob/master/MROCPdjango/dirconformance/renameDerivs.py" target="blank">this script</a>.
    You need to have a directory that contains a folder named <i>fiber</i> (containing fiber files)
    Ensure you have backups before doing this. <FONT COLOR='#2373ff'> This may change in the future.</FONT>

      <h3>What's the difference between big and small graphs?</h3>

      <p>
      Glad you asked! The big graph term is particularly germane to fiber streamline graphs with dimensions greater than 70 x 70, where a largest
      connected component is required when computing invariants. If you have a small fiber streamline graph (dimension < 70 x 70) or any other
      graph you should select the small graph option (which is the default if you choose not to select either).
      </p>

      <p>
      Please note the big graphs the MROCP constructs are on the order of > 10 M x 10 M vertices, but are other wise identical to
      small graph. Working with big graphs requires the largest connected component (LCC) as well since we do not consider
      grey matter in computation.
      </p>
    </ul>
    -->

    <h4> You must supply an <FONT COLOR='#ff0000'> Email address: </FONT> </h4>

    You will receive an email at the start and end of the job completion email with a url link for the result.<br/>
    <FONT COLOR='#2373ff'>
      We do not save email addresses. We will never share or use your email address for any other purpose.
    </FONT>
    </p>

      <form action="" method="post" enctype="multipart/form-data" name="loadForm" onsubmit="return (Validate(this,['.mat', '.zip'] ) && checkLcc())" class="forms" id="id_loadForm">
          {% csrf_token %}
          {{ graphUploadForm.as_ul }}
          <input name = "Derivatives"  type="submit" value="Upload Graph(s)" class="button" onclick="showSpinner();"/>
          <input type="reset" value="Reset" class="button" name="clearForm" />
      </form>

    <div style="position:absolute; left:153px; top: 1300px;">
      <img id="loadingImage" src="{{STATIC_URL}}images/loading.gif" border="0" alt="loading" style="visibility:hidden;opacity:0.5"/>
    </div>

    {% block programmatic %}
      <div id="programmatic">
      <h2> Programmatic use </h2>
      <p> This is can be accessed using the base url <strong>http://www.mrbrain.cs.jhu.edu/disa/graphupload/</strong>. The
          example of usage can be found <a href="https://github.com/openconnectome/MR-connectome/blob/master/MROCPdjango/examples/computeInvariants.py" target="blank">here</a>.

        <h3> How to use the example </h3>
        <p>After downlaod in the <a href="https://github.com/openconnectome/MR-connectome/blob/master/MROCPdjango/examples/computeInvariants.py" target="blank">example</a>,
         start a terminal session. Assuming you are in the same directory as the example. Typing <strong>python computeInvariants.py -h</strong> will give help on how to use the
         example and what options are available to you. <br/>

        <h2> Single graph </h2>
        Assume we have a single graph located in the same directory as the example scipt named <em>data.<FONT COLOR='#ff0000'>mat</FONT></em>.
        Typing <strong>python computeInvariants.py http://www.mrbrain.cs.jhu.edu/disa/graphupload/ cc,tri,ss1 data.mat -c mat</strong> will
        upload your <em>data.mat</em> file and compute the clustering co-efficient, local triangle count, and scan statistic-1. You must wait for the http response
        to get the url containing the result.

        The optional arguments given as -i are simply appended to the final url in uploadsubj.py. The options available must be in a comma separated list and are as follows:
        <ul>
          <li> <i>ss1</i> for the Scan Statistic 1</li>
          <li> <i>tri</i> for the Triangle Count </li>
          <li> <i>cc</i> for the Clustering Coefficient</li>
          <li> <i>mad</i> for the Maximum Average Degree</li>
          <li> <i>deg</i> for The Local Degree Count</li>
          <li> <i>eig</i> for the Top 100 (or maximum available) eigenvalues</li>
          <li> <i>ss2</i> for the Scan Statistic 2 [Coming soon]</li>
          <li> <i>apl</i> for the Average Path Length [Coming soon]</li>
          <li> <i>gdia</i> for the Graph Diameter [Coming soon]</li>
        </ul>

        <h3> Multiple graphs </h3>
        <p>
        <a href="https://github.com/openconnectome/MR-connectome/blob/master/MROCPdjango/examples/uploadMultiSubj.py">Multi-subject/scan example</a>
        is also provided as an example of how to process multiple scans with a single programmatic call.<br/>

        From within a terminal session, it can be used as follows: <strong>python uploadMultiSubj.py http://mrbrain.cs.jhu.edu/disa/upload/YOUR_project/YOUR_site/YOUR_subject/YOUR_session/ s
        fiber_tract_dirctory roi_dirctory -i cc,tri,ss1,mad,deg,eig.</strong> This call would build graphs for multiple scans and compute all invariants noted in the -i flag.
        The example assumes the following:

        <ul>
          <li>There is a directory containing all fiber tract files you wish to be processed with no other sub-directories or files you do not wish to process.</li>
          <li>There is a directory containing all corresponding roi files (i.e both an xml and raw file for each fiber tract file) with file names in accordance with the convention noted below.
          <strong>Note the root of each roi file name should:</strong>
            <ol>
              <li>End in <strong> _roi</strong> E.g filename_roi.xml and filename_roi.raw.</li>
              <li>
                Be identical to the root of its corresponding fiber tract file. E.g If the fiber file name is <strong> sample1.dat</strong>,
                then there must be a <strong>sample1_roi.raw</strong> AND a <strong> sample1_roi.xml</strong>. Thus the root is <strong>sample1</strong> in this example.
              </li>
            </ol>
          </li>
        </ul>

        <p>
        All fiber tract files  will be treated as single project with multiple scanIDs derived from the file name.
        <a href="https://github.com/openconnectome/MR-connectome/blob/master/MROCPdjango/examples/uploadMultiSubj.py">Download the file</a>
        and help can be obtained by typing in a terminal/command line session:
        <strong>python uploadMultiSubj.py -h </strong>. The same is true for the single scan example, where: <strong>python uploadsubj.py -h</strong> gives help.




      </p>
      </div>
    {% endblock programmatic %}
  {% endblock content%}
