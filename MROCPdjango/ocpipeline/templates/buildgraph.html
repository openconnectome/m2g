{% extends "base.html" %}

  {% block title %}
    Build Graph | MROCP
  {% endblock title %}

  {% block medheading %}
  Build a fiber tractography streamline graph
  {% endblock medheading %}

  {% block content %}

  <p>Please complete the entire form below, upload data derivative files and optionally select any invariants to be computed.
<b><font color='#ff0000'>{{error_msg}}</font></b> <br/>

  You must supply an Email address for big graph processing so as to receive the job completion email with result url.<br/>
  <font color='#2373ff'> We will never share or use your email address for any other purpose.</font>
  </p>
      <form action="" class="nostyle" method="post" enctype="multipart/form-data" name="loadForm" onsubmit="return Validate(this,['.xml','.dat','.raw'] );">
        {% csrf_token %}
        <ul>{{ buildGraphform.as_ul }}</ul>
        <input name = "Derivatives"  type="submit" value="Submit All and Process" class="button" onclick="showSpinner();"/>
        <input type="reset" value="Reset" class="button" name="clearForm" />
      </form>

    <div style="position:absolute; left:153px; top: 600px;">
      <img id="loadingImage" src="{{STATIC_URL}}images/loading.gif" border="0" alt="loading" style="visibility:hidden;opacity:0.5"/>
    </div>

    {% block programmatic %}
      <div id="programmatic">
        <h2> Graphs may also be built programmatically </h2>
        The base url for building graphs is <pre>http://mrbrain.cs.jhu.edu/disa/upload/</pre>

        <h3> Single graph </h3>
        <p>
        The example <a href="https://github.com/openconnectome/MR-connectome/blob/master/MROCPdjango/examples/uploadsubj.py"
        target="blank"> uploadsubj.py</a> can be used as follows from a terminal session:
        </p>
        <code>python uploadsubj.py http://mrbrain.cs.jhu.edu/disa/upload/progmatic/site/subj/sess/scan/s YOUR_FIBER.dat YOUR_ROI.xml YOUR_ROI.raw -i cc,tri,ss1,mad,deg,eig</code>
        <p>
         The parameter after YOUR_scan can either be <code>s</code> or <code>b</code>, but not both. Using <code>s</code> or <code>small</code> builds a small graph
         (70 x 70 vertices) while <code>b</code> or <code>big</code> builds a big graph on the order of 10 M x 10 M vertices. <br/>

         The particular invocation in bold above would build a small graph and compute all invariants currently available. A list of invariant contractions is
         available below.
         <strong>The result of uploadsubj.py is a url containing all data produced. Simply wait for the http response and follow the url to download it.</strong>
         We recommend starting a <a href="http://tmux.sourceforge.net/" target="blank">tmux</a> or <a href="http://linux.die.net/man/1/screen" target="blank"> screen </a> session in case your processing time
         is lengthy.
        </p>

        The optional arguments given as <code>-i</code> are simply appended to the final url in uploadsubj.py. The options available must be in a comma separated list and are as follows:
        <ul>
          <li> <code>ss1</code> for the Scan Statistic 1</li>
          <li> <code>tri</code> for the Triangle Count </li>
          <li> <code>cc</code> for the Clustering Coefficient</li>
          <li> <code>mad</code> for the Maximum Average Degree</li>
          <li> <code>deg</code> for The Local Degree Count</li>
          <li> <code>eig</code> for the Top-k (50 or maximum available/computable) eigenvectors and eigenvalues</li>
        </ul>

        <h3> Multiple graphs </h3>
        <p>
        An example of a <a href="https://github.com/openconnectome/MR-connectome/blob/master/MROCPdjango/examples/uploadMultiSubj.py" target="blank">Multiple subject</a> job
        is also provided. This is as an example of how to process multiple jobs with a single programmatic call.<br/>

        From within a terminal/command line session, it can be used as follows: <br/>

        <code>python uploadMultiSubj.py http://mrbrain.cs.jhu.edu/disa/upload/YOUR_project/YOUR_site/YOUR_subject/YOUR_session/s fiber_tract_dirctory roi_dirctory -i cc,tri,ss1,mad,deg,eig</code><br/>

        This call would build graphs for multiple scans and compute all invariants noted in the <code>-i</code> flag.
        The example assumes the following:

        <ul>
          <li>There is a directory containing all fiber tract files you wish to be processed with no other sub-directories or files you do not wish to process.</li>
          <li>There is a directory containing all corresponding roi files (i.e both an xml and raw file for each fiber tract file) with file names in accordance with the convention noted below.
          <strong>Note the root of each roi file name should:</strong>
            <ol>
              <li>End in <strong> _roi</strong> E.g filename_roi.xml and filename_roi.raw.</li>
              <li>
                Be identical to the root of its corresponding fiber tract file. E.g If the fiber tract file name is <strong> sample1.dat</strong>,
                then there must be a <strong>sample1_roi.raw</strong> AND a <strong> sample1_roi.xml</strong>. Thus the root is <strong>sample1</strong> in this example.
              </li>
            </ol>
          </li>
        </ul>

        All fiber tract files  will be treated as a single project with multiple scanIDs derived from the file name.
        <a href="https://github.com/openconnectome/MR-connectome/blob/master/MROCPdjango/examples/uploadMultiSubj.py" target="blank">Download the file</a>
        and help can be obtained by typing the following in a terminal/command line session: <br/>
        <code>python uploadMultiSubj.py -h</code>. The same is true for the single scan example, where: <code>python uploadsubj.py -h</code> gives help.
      </div>
        </p>
    {% endblock programmatic %}

        <div id="Graph_specs">
           <h2>Specifications for graphs built</h2>
            <ul>
              <li> A <a href="http://www.mathworks.com/help/matlab/ref/struct.html" target="blank"> MATLAB struct </a> with a data element named named
              <code>fibergraph</code> that is a <a href="http://docs.scipy.org/doc/scipy/reference/generated/scipy.sparse.csc_matrix.html#scipy.sparse.csc_matrix" target="blank">
              numpy CSC (Compressed Sparse Column) matrix</a>. <br/>
              It is loadable from a python shell using <code><a href="http://docs.scipy.org/doc/scipy/reference/generated/scipy.io.loadmat.html" target="blank">scipy.io.loadmat</a>(filename)['fibergraph']</code>
              </li>

              <h3>What's the difference between big and small graphs?</h3>

              Glad you asked! The terms big/small graph are particularly relevant to fiber streamline graphs. Small graphs are of dimension 70 x 70 vertices. <br/>
              Big graphs can be in the <b>millions</b> of vertices.
            </ul>
        </div>
  {% endblock content%}
